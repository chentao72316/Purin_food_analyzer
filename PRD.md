# 食物嘌呤识别网站 - 产品需求文档 (PRD)

## 1. 项目概述

### 1.1 项目名称
食物嘌呤识别分析系统

### 1.2 项目背景
帮助用户通过上传或拍摄食物图片，快速识别食物中的嘌呤含量，并提供可视化标注和详细的食物信息，辅助痛风患者和关注嘌呤摄入的人群进行饮食管理。

### 1.3 项目目标
- 提供便捷的食物嘌呤识别服务
- 通过AI模型自动识别和分析食物嘌呤含量
- 提供直观的可视化标注和食物信息展示

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 图片上传功能
**功能描述：**
- 用户可以通过以下方式提供图片：
  - 从本地文件上传图片
  - 使用设备摄像头拍照
- 支持的图片格式：JPG、PNG、JPEG、WEBP
- 图片大小限制：建议最大10MB
- 图片尺寸：建议最小256x256像素

**交互要求：**
- 提供拖拽上传区域
- 提供文件选择按钮
- 提供拍照按钮（移动端优先）
- 显示上传进度
- 支持图片预览

#### 2.1.2 AI模型识别功能
**功能描述：**
- 调用豆包1.6 Flash 0828模型进行食物识别和分析
- 模型需要完成以下任务：
  1. 识别图片中的所有食物
  2. 分析每个食物的嘌呤数值（每100克食物中的嘌呤含量，单位：毫克）
  3. 根据嘌呤含量进行分类：
     - 高嘌呤：>150毫克/100克
     - 中嘌呤：50-150毫克/100克
     - 低嘌呤：<50毫克/100克
  4. 返回高嘌呤食物的框选坐标（按组返回）
  5. 返回中嘌呤食物的框选坐标（按组返回）
  6. 返回高嘌呤食物的介绍信息
  7. 返回中嘌呤食物的介绍信息

**模型接口要求：**
- 请求格式：POST请求，包含图片数据
- 响应格式：JSON格式，包含以下字段：
  ```json
  {
    "high_purine_foods": [
      {
        "food_name": "食物名称",
        "purine_value": 180,
        "coordinates": {
          "x1": 100,
          "y1": 150,
          "x2": 300,
          "y2": 250
        },
        "description": "食物详细介绍"
      }
    ],
    "medium_purine_foods": [
      {
        "food_name": "食物名称",
        "purine_value": 120,
        "coordinates": {
          "x1": 350,
          "y1": 200,
          "x2": 500,
          "y2": 350
        },
        "description": "食物详细介绍"
      }
    ],
    "low_purine_foods": [
      {
        "food_name": "食物名称",
        "purine_value": 30
      }
    ]
  }
  ```

**坐标系统：**
- 使用像素坐标系统
- 坐标格式：{x1, y1, x2, y2}，表示左上角和右下角坐标
- 坐标原点(0,0)位于图片左上角

#### 2.1.3 可视化标注功能
**功能描述：**
- 在原始图片上根据模型返回的坐标绘制标注框
- 高嘌呤食物：使用深红色方框标注（RGB: #8B0000 或类似深红色）
- 中嘌呤食物：使用红色方框标注（RGB: #FF0000 或类似红色）
- 标注框要求：
  - 框线宽度：2-3像素
  - 在标注框上方或内部显示食物名称
  - 标注框应清晰可见，不遮挡食物主体

**技术实现：**
- 使用Canvas或SVG在图片上绘制标注
- 支持响应式缩放，保持坐标比例

#### 2.1.4 食物信息展示功能
**功能描述：**
- 在页面中展示高嘌呤食物的详细信息
- 在页面中展示中嘌呤食物的详细信息
- 信息包括：
  - 食物名称
  - 嘌呤含量数值（毫克/100克）
  - 嘌呤等级（高/中）
  - 食物详细介绍

**展示要求：**
- 高嘌呤食物和中嘌呤食物分别分组展示
- 使用卡片或列表形式展示
- 高嘌呤食物使用醒目的样式（如深红色背景或边框）
- 中嘌呤食物使用中等醒目的样式（如红色背景或边框）
- 低嘌呤食物可选择性地简要展示或隐藏

## 3. 非功能需求

### 3.1 性能要求
- 图片上传响应时间：< 2秒
- 模型识别响应时间：< 10秒（取决于模型性能）
- 页面加载时间：< 3秒
- 支持并发用户数：至少100

### 3.2 兼容性要求
- 浏览器：Chrome、Firefox、Safari、Edge（最新版本）
- 移动端：iOS Safari、Android Chrome
- 响应式设计：支持桌面端、平板、手机

### 3.3 安全性要求
- 图片数据加密传输（HTTPS）
- 用户上传的图片不永久存储（或提供删除选项）
- API接口需要认证和限流

### 3.4 可用性要求
- 界面简洁直观
- 操作流程清晰
- 提供加载状态提示
- 提供错误提示和异常处理

## 4. 用户界面设计

### 4.1 页面布局
```
┌─────────────────────────────────────┐
│         页面标题/Logo                │
├─────────────────────────────────────┤
│                                     │
│      图片上传区域/预览区域          │
│    (包含标注框的图片展示)           │
│                                     │
├─────────────────────────────────────┤
│  高嘌呤食物 (>150mg/100g)          │
│  ┌─────┐ ┌─────┐                   │
│  │食物1│ │食物2│ ...                │
│  └─────┘ └─────┘                   │
├─────────────────────────────────────┤
│  中嘌呤食物 (50-150mg/100g)        │
│  ┌─────┐ ┌─────┐                   │
│  │食物1│ │食物2│ ...                │
│  └─────┘ └─────┘                   │
└─────────────────────────────────────┘
```

### 4.2 交互流程
1. 用户进入页面
2. 用户选择上传图片或拍照
3. 系统显示图片预览
4. 用户点击"开始识别"按钮
5. 系统显示加载状态
6. 系统调用AI模型进行识别
7. 系统在图片上绘制标注框
8. 系统展示食物信息列表
9. 用户可以重新上传图片进行新的识别

## 5. 技术架构

### 5.1 前端技术栈
- 框架：React / Vue.js / Next.js（推荐）
- UI组件库：Ant Design / Material-UI / Tailwind CSS
- 图片处理：Canvas API / Fabric.js
- HTTP客户端：Axios / Fetch API

### 5.2 后端技术栈
- 框架：Node.js / Python Flask / FastAPI
- AI模型接口：豆包1.6 Flash 0828 API
- 图片处理：Pillow / OpenCV（如需要预处理）

### 5.3 数据流
```
用户上传图片 
  → 前端验证和预览 
  → 发送到后端API 
  → 后端调用豆包模型API 
  → 模型返回识别结果 
  → 后端处理数据 
  → 返回给前端 
  → 前端绘制标注框和展示信息
```

## 6. API设计

### 6.1 图片识别接口
**接口地址：** `/api/analyze`

**请求方法：** POST

**请求参数：**
- `image`: File类型，图片文件（multipart/form-data）

**响应格式：**
```json
{
  "success": true,
  "data": {
    "high_purine_foods": [
      {
        "food_name": "动物肝脏",
        "purine_value": 180,
        "coordinates": {
          "x1": 100,
          "y1": 150,
          "x2": 300,
          "y2": 250
        },
        "description": "动物肝脏是典型的高嘌呤食物，每100克含有约180毫克嘌呤。痛风患者应尽量避免或限制摄入。"
      }
    ],
    "medium_purine_foods": [
      {
        "food_name": "鸡肉",
        "purine_value": 120,
        "coordinates": {
          "x1": 350,
          "y1": 200,
          "x2": 500,
          "y2": 350
        },
        "description": "鸡肉属于中等嘌呤食物，每100克含有约120毫克嘌呤。可以适量食用，但不宜过量。"
      }
    ],
    "low_purine_foods": [
      {
        "food_name": "白菜",
        "purine_value": 30
      }
    ]
  },
  "message": "识别成功"
}
```

**错误响应：**
```json
{
  "success": false,
  "error": "错误信息",
  "code": "ERROR_CODE"
}
```

**错误代码定义：**
- `INVALID_IMAGE_FORMAT`: 图片格式不支持
- `IMAGE_TOO_LARGE`: 图片大小超限
- `NETWORK_ERROR`: 网络请求失败
- `MODEL_ERROR`: 模型识别失败
- `NO_FOOD_DETECTED`: 图片中未识别到食物
- `INVALID_COORDINATES`: 坐标数据异常

## 7. 异常处理

### 7.1 错误场景
- 图片格式不支持
- 图片大小超限
- 网络请求失败
- 模型识别失败
- 图片中未识别到食物
- 坐标数据异常

### 7.2 错误提示
- 所有错误都需要向用户展示友好的提示信息
- 提供重试机制
- 记录错误日志（后端）

### 7.3 错误处理流程
1. 前端捕获错误
2. 根据错误类型显示相应的提示信息
3. 提供"重试"或"重新上传"选项
4. 后端记录错误日志（包含时间戳、错误类型、用户信息等）

## 8. 测试要求

### 8.1 功能测试
- 图片上传功能测试
  - 测试不同格式的图片上传
  - 测试拖拽上传
  - 测试拍照功能
  - 测试文件大小限制
- 模型识别准确性测试
  - 测试不同食物的识别准确率
  - 测试多食物场景
  - 测试边界情况（模糊图片、复杂背景等）
- 标注框绘制准确性测试
  - 测试坐标转换准确性
  - 测试响应式缩放
  - 测试标注框显示效果
- 信息展示完整性测试
  - 测试数据展示完整性
  - 测试不同数据量的展示
  - 测试空数据情况

### 8.2 兼容性测试
- 不同浏览器测试
  - Chrome、Firefox、Safari、Edge
- 不同设备测试
  - 桌面端、平板、手机
- 不同图片格式测试
  - JPG、PNG、JPEG、WEBP

### 8.3 性能测试
- 大图片处理测试（10MB以上）
- 并发请求测试（100+用户）
- 响应时间测试
  - 上传响应时间
  - 识别响应时间
  - 页面加载时间

### 8.4 安全性测试
- HTTPS传输测试
- 文件类型验证测试
- API限流测试
- 数据隐私测试

## 9. 开发计划

### 9.1 第一阶段：基础功能（2周）
**目标：** 完成核心功能的基础实现

**任务清单：**
- [ ] 项目初始化和环境搭建
- [ ] 前端基础框架搭建
- [ ] 图片上传功能实现
- [ ] 图片预览功能实现
- [ ] 后端API框架搭建
- [ ] 豆包模型API对接
- [ ] 基础UI界面实现

**交付物：**
- 可上传图片的前端页面
- 可调用模型的后端API
- 基础的数据展示

### 9.2 第二阶段：核心功能（3周）
**目标：** 完成所有核心功能的完整实现

**任务清单：**
- [ ] 标注框绘制功能实现
- [ ] 坐标转换和响应式处理
- [ ] 食物信息展示功能实现
- [ ] 高/中/低嘌呤分类展示
- [ ] 错误处理和异常提示
- [ ] UI/UX优化
- [ ] 移动端适配

**交付物：**
- 完整的识别和标注功能
- 完整的食物信息展示
- 响应式设计

### 9.3 第三阶段：优化完善（2周）
**目标：** 性能优化、测试和bug修复

**任务清单：**
- [ ] 性能优化（图片压缩、缓存等）
- [ ] 全面功能测试
- [ ] 兼容性测试
- [ ] Bug修复
- [ ] 用户体验优化
- [ ] 文档编写

**交付物：**
- 测试报告
- 优化后的完整系统
- 用户使用文档

## 10. 后续扩展功能（可选）

### 10.1 用户功能
- 用户账户系统
- 历史记录功能
- 个人嘌呤摄入量统计
- 饮食建议推荐

### 10.2 数据功能
- 食物数据库查询
- 常见食物嘌呤含量查询
- 食物营养成分查询

### 10.3 社交功能
- 分享识别结果
- 社区讨论
- 专家咨询

### 10.4 其他功能
- 多语言支持
- 语音识别输入
- 批量图片识别
- 导出识别报告

## 11. 数据模型

### 11.1 食物识别结果数据结构
```typescript
interface FoodItem {
  food_name: string;        // 食物名称
  purine_value: number;     // 嘌呤含量（毫克/100克）
  coordinates?: {           // 坐标（可选，低嘌呤食物可能没有）
    x1: number;            // 左上角x坐标
    y1: number;            // 左上角y坐标
    x2: number;            // 右下角x坐标
    y2: number;            // 右下角y坐标
  };
  description?: string;     // 食物介绍（可选）
}

interface AnalysisResult {
  high_purine_foods: FoodItem[];    // 高嘌呤食物列表
  medium_purine_foods: FoodItem[];  // 中嘌呤食物列表
  low_purine_foods: FoodItem[];     // 低嘌呤食物列表
}
```

### 11.2 API响应数据结构
```typescript
interface ApiResponse {
  success: boolean;
  data?: AnalysisResult;
  message?: string;
  error?: string;
  code?: string;
}
```

## 12. 界面设计规范

### 12.1 颜色规范
- **高嘌呤食物标注框：** #8B0000（深红色）
- **中嘌呤食物标注框：** #FF0000（红色）
- **高嘌呤食物卡片背景：** #FFF5F5（浅红色背景）
- **中嘌呤食物卡片背景：** #FFF0F0（更浅的红色背景）
- **主要按钮：** #1890FF（蓝色）
- **警告提示：** #FF4D4F（红色）
- **成功提示：** #52C41A（绿色）

### 12.2 字体规范
- **标题：** 18-24px，加粗
- **正文：** 14-16px，常规
- **说明文字：** 12-14px，浅色
- **食物名称：** 16px，加粗

### 12.3 间距规范
- **卡片间距：** 16px
- **内容内边距：** 16-24px
- **区块间距：** 32px

## 13. 部署要求

### 13.1 服务器要求
- 支持HTTPS
- 支持文件上传
- 支持Node.js或Python运行环境
- 建议配置CDN加速

### 13.2 环境配置
- 生产环境变量配置
- API密钥管理
- 日志系统配置
- 监控和告警配置

## 附录：嘌呤分类标准

### 分类定义
- **高嘌呤食物**：每100克食物中嘌呤含量 > 150毫克
- **中嘌呤食物**：每100克食物中嘌呤含量 50-150毫克
- **低嘌呤食物**：每100克食物中嘌呤含量 < 50毫克

### 常见食物嘌呤含量参考
**高嘌呤食物（>150mg/100g）：**
- 动物内脏（肝脏、肾脏等）：150-300mg
- 浓肉汤：150-200mg
- 沙丁鱼：200-300mg
- 凤尾鱼：200-300mg

**中嘌呤食物（50-150mg/100g）：**
- 大部分肉类（猪肉、牛肉、鸡肉）：100-150mg
- 大部分鱼类：100-150mg
- 豆类：50-150mg

**低嘌呤食物（<50mg/100g）：**
- 大部分蔬菜：<50mg
- 大部分水果：<50mg
- 谷物：<50mg
- 蛋类：<50mg

---

## 文档版本历史

| 版本 | 日期 | 修改内容 | 修改人 |
|------|------|----------|--------|
| 1.0 | 2024-XX-XX | 初始版本 | - |

---

**文档状态：** 待评审

**最后更新：** 2024-XX-XX

